<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>도서 등록 및 관리</title>
    <link rel="stylesheet" href="form.css">
</head>
<body>
    <div class="form-container">
        <h1>도서 등록</h1>
        <form id="bookForm" class="form-grid">
            <div class="form-group">
                <label for="title">제목:</label>
                <input type="text" id="title" name="title">
            </div>
            <div class="form-group">
                <label for="author">저자:</label>
                <input type="text" id="author" name="author">
            </div>
            <div class="form-group">
                <label for="isbn">ISBN:</label>
                <input type="text" id="isbn" name="isbn">
            </div>
            <div class="form-group">
                <label for="price">가격:</label>
                <input type="text" id="price" name="price">
            </div>
            <div class="form-group">
                <label for="publishDate">출판일:</label>
                <input type="date" id="publishDate" name="publishDate">
            </div>
            <button type="submit">등록</button>
        </form>

        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>제목</th>
                        <th>저자</th>
                        <th>ISBN</th>
                        <th>가격</th>
                        <th>출판일</th>
                    </tr>
                </thead>
                <tbody id="bookTableBody">
                    <tr>
                        <td>예시 책</td>
                        <td>홍길동</td>
                        <td>1234567890</td>
                        <td>15000</td>
                        <td>2025-08-25</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        const API_BASE_URL = "http://localhost:8080";
        const bookForm = document.getElementById("bookForm");
        const bookTableBody = document.getElementById("bookTableBody");

        // 폼 제출 이벤트
        bookForm.addEventListener("submit", function(event){
            event.preventDefault();
            const formData = new FormData(bookForm);
            const bookData = Object.fromEntries(formData.entries());

            fetch(`${API_BASE_URL}/books`, {
                method: "POST",
                headers: {"Content-Type": "application/json"},
                body: JSON.stringify(bookData)
            })
            .then(res => res.json())
            .then(data => {
                alert("도서 등록 성공!");
                appendBookToTable(data);
                bookForm.reset();
            })
            .catch(err => console.error("Error:", err));
        });

        function appendBookToTable(book){
            const row = document.createElement("tr");
            row.innerHTML = `
                <td>${book.title}</td>
                <td>${book.author}</td>
                <td>${book.isbn}</td>
                <td>${book.price}</td>
                <td>${book.publishDate}</td>
            `;
            bookTableBody.appendChild(row);
        }

        // 초기 데이터 불러오기
        function loadBooks(){
            fetch(`${API_BASE_URL}/books`)
                .then(res => res.json())
                .then(data => data.forEach(book => appendBookToTable(book)));
        }

        loadBooks();
    </script>
</body>
</html>
